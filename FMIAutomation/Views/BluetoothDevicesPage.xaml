<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FMIAutomation.Views.BluetoothDevicesPage"
             BackgroundColor="{AppThemeBinding Light={StaticResource LoginBackgroundLight}, Dark={StaticResource LoginBackgroundDark}}">
    <Grid RowDefinitions="Auto, Auto, Auto, *">
        <!-- Header -->
        <Grid Row="0" Padding="20,20,20,10" ColumnDefinitions="*,Auto,Auto">
            <Label Text="Dispositivos Bluetooth" TextColor="#3B5A7A" FontSize="24" FontAttributes="Bold" />
            <Button x:Name="ScanBtn" Text="{Binding ScanButtonText}" FontSize="14" Padding="15,8" CornerRadius="20" BackgroundColor="#3B5A7A" TextColor="White" Grid.Column="1" Command="{Binding ScanCommand}" Margin="0,0,10,0" />
            <Button x:Name="AddDeviceBtn" Text="+" FontSize="28" WidthRequest="48" HeightRequest="48" CornerRadius="24" BackgroundColor="#4CAF50" TextColor="White" Grid.Column="2" />
        </Grid>
        
        <!-- Status Bar -->
        <Grid Row="1" Padding="20,0,20,10" ColumnDefinitions="*,Auto">
            <Label Text="{Binding StatusMessage}" TextColor="#666" FontSize="14" VerticalOptions="Center" />
            <ActivityIndicator IsVisible="{Binding IsLoading}" IsRunning="{Binding IsLoading}" Color="#3B5A7A" Grid.Column="1" />
        </Grid>
        
        <!-- Dispositivos Pareados -->
        <ScrollView Grid.Row="2" Padding="20,10,20,0">
            <StackLayout>
            <Label Text="Dispositivos Pareados" TextColor="#3B5A7A" FontSize="18" FontAttributes="Bold" Margin="0,0,0,10" />
            <CollectionView ItemsSource="{Binding PairedDevices}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="15" ColumnDefinitions="Auto,*,Auto,Auto" RowDefinitions="Auto,Auto">
                            <!-- Ícone do dispositivo -->
                            <Label Grid.Column="0" Grid.RowSpan="2" Text="{Binding DeviceIcon}" FontSize="24" VerticalOptions="Center" Margin="0,0,15,0" />
                            
                            <!-- Nome e endereço -->
                            <Label Grid.Column="1" Grid.Row="0" Text="{Binding Name}" FontAttributes="Bold" FontSize="16" TextColor="{AppThemeBinding Light={StaticResource LoginTextLight}, Dark={StaticResource LoginTextDark}}" />
                            <Label Grid.Column="1" Grid.Row="1" Text="{Binding StatusText}" FontSize="12" TextColor="#666" />
                            
                            <!-- Botão de conexão -->
                            <Button Grid.Column="2" Grid.RowSpan="2" Text="Conectar"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ConnectDeviceCommand}" 
                                    CommandParameter="{Binding .}" 
                                    BackgroundColor="#4CAF50" 
                                    TextColor="White" FontSize="12" Padding="10,5" CornerRadius="15" Margin="5,0" />
                            
                            <!-- Botão de desparear -->
                            <Button Grid.Column="3" Grid.RowSpan="2" Text="✕" 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.UnpairDeviceCommand}" 
                                    CommandParameter="{Binding .}" 
                                    BackgroundColor="#F44336" TextColor="White" FontSize="12" WidthRequest="30" HeightRequest="30" CornerRadius="15" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            </StackLayout>
        </ScrollView>
        
        <!-- Dispositivos Descobertos -->
        <ScrollView Grid.Row="3">
            <StackLayout Padding="20,20,20,10">
                <Label Text="Dispositivos Disponíveis" TextColor="#3B5A7A" FontSize="18" FontAttributes="Bold" Margin="0,0,0,10" />
                <CollectionView ItemsSource="{Binding DiscoveredDevices}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="15" ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">
                                <!-- Ícone do dispositivo -->
                                <Label Grid.Column="0" Grid.RowSpan="2" Text="{Binding DeviceIcon}" FontSize="24" VerticalOptions="Center" Margin="0,0,15,0" />
                                
                                <!-- Nome e informações -->
                                <Label Grid.Column="1" Grid.Row="0" Text="{Binding Name}" FontAttributes="Bold" FontSize="16" TextColor="{AppThemeBinding Light={StaticResource LoginTextLight}, Dark={StaticResource LoginTextDark}}" />
                                <Label Grid.Column="1" Grid.Row="1" Text="{Binding SignalStrengthText}" FontSize="12" TextColor="#666" />
                                
                                <!-- Botão de parear -->
                                <Button Grid.Column="2" Grid.RowSpan="2" Text="Parear" 
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.PairDeviceCommand}" 
                                        CommandParameter="{Binding .}" 
                                        BackgroundColor="#2196F3" TextColor="White" FontSize="12" Padding="10,5" CornerRadius="15" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
                <!-- Mensagem quando não há dispositivos -->
                <Label Text="Nenhum dispositivo encontrado. Toque em 'Escanear' para procurar dispositivos próximos." 
                       TextColor="#666" FontSize="14" HorizontalTextAlignment="Center" Margin="0,20" />
            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
